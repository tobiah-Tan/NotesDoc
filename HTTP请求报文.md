# HTTP请求报文/响应报文

## 一、HTTP协议

### 1.1、 简介

- HTTP协议又称超文本传输协议(Hyper Text Transfer Protocol)，用于万维网服务器传输超文本到本地浏览器的传送协议

- HTTP基于TCP/IP通信协议来传递数据

- HTTP基于客户端/服务端（C/S）架构模型，通过一个可靠的链接来交换信息，是一个无状态的请求/响应协议

### 1.2 、特点

- HTTP是无连接的：无连接的含义就是现实每次链接之处理一个请求，服务器处理完客户的请求，并受到客户的应答后，即断开链接，采用这种方式可以节省传输时间
- HTTP是媒体独立的，只要客户端和服务器知道如何处理的数据内容，任何类型的数据都可以通过HTTP发送，客户端以及服务器指定使用适合的MIME-type内容类型。
  - MIME-type：是资源的媒体类型，通过HTTP协议，由web服务器告知浏览器，更准确的说，是通过Content-Type来表示的，例如`Content-Type:text/HTML`
  - MIME-type不是个人指定的，是由ietf组织协商，以RFC的形式作为建议的标准发布在网上的，大多数web服务器和用户代理都会支持这个规范。
- HTTP是无状态的：无状态是之协议对于事务处理没有记忆能力，缺少状态意味着如果后续处理需要前面的信息，则它必须重传，这样可能导致每次链接传送的数据量增大，另一方面，再服务器不需要先前信息时他的应答就比较快。

### 1.3、  构成

HTTP请求报文由三个部分组成：

- 请求行
- 请求头
- 请求体

#### 1.3.1  请求行

- 请求方法：GET/POST时最常见的HTTP请求方法，除此之外还包括DELETE、HEAD、OPTIONS、PUT、TRACE
- 为请求对应的url地址，他的报文头的Host属性组成完成的请求URL
- 协议名称以及版本号

#### 1.3.2 请求头

- HTTP的报文头，报文头包含若干个属性，格式为“属性名：属性值”，服务端据此获取客户端的信息。
- 与缓存相关的规则信息，均包含在header中

#### 1.3.3 请求体

- 报文体，将一个页面表单中的组件值通过`param1=value1&param2=value2`的键值对形式编码成一个格式化串，它承载多个请求参数的数据，不但报文体可以传递请求参数，请求URL也可以通过类似于`/chapter15/user.html? param1=value1&param2=value2`的方式传递请求参数

## 2、HTTP请求报文头属性

### 2.1、 Accept

通过Accept报文头属性告诉服务器，客户端接收什么类型的响应。

Accept属性的值可以为一个或多个MIME类型的值

### 2.2、 Cookie

#### 2.2.1 客户端的Cookie就是通过这个报文头属性传给服务端的

`Cookie: $Version=1; Skin=new;jsessionid=5F4771183629C9834F8382E23`

- 原因：HTTP协议是无状态协议(不保存状态，即不保留之前的一切请求或相应信息)，为了提高效率，希望保持状态功能，引入cookie技术
- Cookie：就是一段字符串，是浏览器保存服务器返回数据的方法，通常保存用户身份信息
- Set-Cookie：服务器向浏览器中种下cookie，当浏览器访问符合条件的url，就会自动带上这个cookie

#### 2.2.2 服务流程

- 客户端第一次请求时，如果服务器像保存用户信息，服务器向客户端响应时会带有set-cookie字段
- 客户端会保存cookie，在下次请求时会自动带上cookie
- 这样服务器收到cookie后，就知道是哪个客户端发来的请求，得到之前的状态信息

Cookie的maxAge决定着Cookie的有效期，单位为秒，Cookie中通过getMaxAge()方法与setMaxAge()方法来读写maxAge属性

- 如果maxAge属性为正数，则表示该Cookie会在maxAge秒之后自动失效
- 如果maxAge为负数，则表示该Cookie仅在本浏览器窗口以及本窗口打开的子窗口内有效，关闭窗口后该Cookie失效
- 如果maxAge为0，则表示删除该Cookie

Cookie并不提供修改、删除操作，如果要修改某个Cookie，只需要新建一个同名Cookie，添加到response中覆盖原来的Cookie

如果想要删除某个Cookie，只需要新建一个同名的Cookie，并将maxAge设置为0，并添加到response中覆盖原来的Cookie

```javascript
Cookie cookie = new Cookie("username","helloweenvsfei");//新建cookie
cookie.setMaxAge(0);//设置生命周期为0，不能为负数
response.addCookie(cookie);//必须执行这一句，输出到客户端
```

### 2.3、Referer

表示这个请求是从哪个URL过来的，假如你通过Google搜索出一个商家的广告界面，你对这个广告页面感兴趣，鼠标点击发送一个请求报文到商家的网站，这个请求报文的Referer报文头属性值就是`http:www.google.com`

### 2.4 Cache-Control

对缓存进行控制，如一个请求希望响应返回的内容在客户端要被缓存一年，或不希望被缓存就可以通过这个报文头达到目的

## 二、HTTP响应报文

### 2.1、 响应报文

HTTP的响应报文也有三部分组成（响应行+响应头+响应体）

- 响应行：
  - 报文协议及版本
  - 状态码及状态描述
- 响应头：
  - 响应报文头，也是由多个属性组成
- 响应体：
  - 响应报文体，即我们真正需要的信息干货

### 2.2、 响应状态码

响应报文多了一个响应状态码，告诉客户端本次请求的处理结果

HTTP的响应状态码由5段组成:

```
1xx 消息，一般是告诉客户端，请求已经收到了，正在处理，别急...
2xx 处理成功，一般表示：请求收悉、我明白你要的、请求已受理、已经处理完成等信息.
3xx 重定向到其它地方。它让客户端再发起一个请求以完成整个处理。
4xx 处理发生错误，责任在客户端，如客户端的请求一个不存在的资源，客户端未被授权，禁止访问等。
5xx 处理发生错误，责任在服务端，如服务端抛出异常，路由出错，HTTP版本不支持等。
```

### 2.3、 常见的HTTP响应报文头属性

#### 2.3.1 cache-control

- 响应输出到客户端后，服务端通过该报文头属性告诉客户端如何控制相应内容的缓存
- 常见的取值有private、public、no-cache、max-age、no-store，**默认为private**
  - private：客户端可以缓存
  - public：客户端和代理服务器都可以缓存
  - max-age = xxx：缓存的内容将在 xxx 秒以后失效
  - no-cache：需要使用xxx来验证缓存数据，所有内容都不会缓存

#### 2.3.2 ETag

一个代表响应服务器资源版本的报文头属性，如果某个服务端自愿发生变化了，这个ETag就会相应发生变化。他是Cache-Control的有益补充，可以让客户端“更智能”处理什么时候要从服务器取资源，什么时候可以直接从换成那种返回响应

#### 2.3.3 Location

我们在JSP中让页面Redirect到一个某个A页面中，其实是让客户端再发一个请求到A页面，这个需要Redirect到的A页面的URL，其实就是通过响应报文头的Location属性告知客户端的，如下的报文头属性，将使客户端redirect的baidu的首页中

```
Location:http://www.baidu.com
```

#### 2.3.4 Set-Cookie

服务端可以设置客户端的Cookie，原理就是通过这个响应报文头的属性实现的：

```
Set-Cookie:UserID=JohnDoe;Max-Age=3600;Version=1
```

